# Feature Specification Document (FSD) - VibeTravels

## 1. Product Overview

VibeTravels is a web-based MVP application that helps users plan engaging trips by transforming simple travel notes into detailed itineraries using AI. This feature specification extends the existing plan details view to include comprehensive activity descriptions, custom activity creation, and activity deletion capabilities.

The Advanced Activities feature enhances the core value proposition by providing users with richer context about AI-suggested activities, enabling them to add their own custom activities, and giving them full control to refine their itineraries by removing unwanted activities. This addresses a critical gap in the current MVP where activities are displayed with only title and duration information, leaving users without sufficient context to evaluate and personalize their travel plans.

Key components of this feature:

- Activity descriptions generated by AI during plan creation (up to 500 characters per activity)
- Accordion interface in ActivityCard for viewing descriptions and activity details
- Transport mode icon display (e.g. car, walk, public transit) in expanded accordion
- Activity timestamps (created_at, updated_at) displayed in expanded accordion
- Custom activity creation with flexible input requirements
- Activity deletion with automatic reordering via dropdown menu
- Description editing capabilities for personalization

This feature aligns with the product's educational and MVP goals by demonstrating advanced AI integration patterns while maintaining implementation simplicity suitable for a 4-week development timeline.

## 2. User Problem

Users planning trips with VibeTravels currently face several limitations that reduce their ability to evaluate and personalize their AI-generated itineraries:

1. Insufficient Activity Context: Activities are displayed with only a title and duration (e.g., "Visit Wawel Castle - 2h"), providing no information about what visitors will actually experience, see, or do. Users must research each activity externally to understand if it aligns with their interests, defeating the purpose of an automated planning tool.

2. No Custom Activity Support: Users cannot add their own activities to the itinerary. If they have specific places they want to visit (family recommendations, personal interests, business obligations), they must track these separately, fragmenting their planning process.

3. Cannot Remove Unwanted Activities: While users can edit activity details, they cannot delete activities they're not interested in. This forces users to work around unwanted activities rather than removing them, resulting in cluttered itineraries.

4. Limited Activity History: Users cannot see when activities were created or last modified, making it difficult to track changes or remember recent additions to their itinerary.

5. Limited Personalization: Without the ability to add notes or modify descriptions, users cannot capture personal context (e.g., "Uncle recommended this restaurant", "Closed on Mondays", "Need to book in advance").

These problems create friction in the user journey from plan generation to actionable itinerary. Users receive AI-generated plans but cannot effectively evaluate, customize, or refine them without leaving the application. This reduces user satisfaction, increases time-to-value, and undermines the core promise of the product: simplified, personalized travel planning.

Target users affected:

- Solo travelers who want to understand each activity before committing
- Families planning trips who need to add child-friendly stops or break activities
- Couples combining partner preferences with AI suggestions
- Business travelers mixing work obligations with leisure activities
- Users familiar with destinations who want to add local favorites

By providing activity descriptions, custom activity creation, and deletion capabilities, this feature transforms VibeTravels from a static itinerary generator into a dynamic planning tool that users can truly make their own.

## 3. Functional Requirements

### 3.1 AI-Generated Activity Descriptions

3.1.1 Description Generation

- The AI service generates a description for every activity during initial plan creation
- Descriptions are included in the same API response that creates the plan (no separate generation step)
- Description length: maximum 500 characters, no enforced minimum
- AI prompt explicitly instructs: "For each activity, provide a detailed description (up to 500 characters) explaining what visitors will experience, see, or do"
- Descriptions must go beyond repeating the activity title and provide substantive information about the experience
- Generated descriptions are stored in the plan_activities table immediately upon plan creation

  3.1.2 Description Content Requirements

- Descriptions explain what visitors will experience, see, or do at the activity location
- Descriptions provide value-add information not obvious from the title alone
- Descriptions are suitable for all audience types (families, solo travelers, couples, business travelers)
- Descriptions contain short information about proposed transport type (one of transport_modes).

  3.1.3 Description Validation

- Backend validates description length â‰¤ 500 characters using Zod schema
- AI-generated activities must have non-null, non-empty descriptions
- Custom activities may have null or empty descriptions
- Invalid descriptions (>500 chars) are rejected at API level with 400 Bad Request

### 3.2 Description Display Interface

3.2.1 Accordion Trigger

- Every ActivityCard functions as an expandable accordion
- A chevron icon (down/up arrow) is displayed at the right edge of the card header
- Chevron rotates to indicate expansion state (down = collapsed, up = expanded)
- Clicking anywhere on the card header (except drag handle and dropdown menu) toggles accordion
- Accordion is accessible via keyboard navigation (tab to card, space/enter to toggle)
- Card has ARIA attributes: role="button", aria-expanded="true/false"
- Visual indicator (chevron) shows expansion state at all times

  3.2.2 Accordion Expanded Content

- When accordion expands, content displays in the following order:
  1. Timestamps row (at the top, before description)
  2. Description text or "No description added" placeholder
  3. Metadata row (duration and transport: "â±ï¸ 2h â€¢ ðŸš— 15 min")
- Timestamps display format: "YYYY-MM-DD HH:mm" (ISO format, 24-hour)
- Timestamps display logic:
  - If created_at equals updated_at: show "Created: 2026-01-05 14:30"
  - If updated_at is different: show "Created: 2026-01-05 14:30 â€¢ Updated: 2026-01-05 16:45"
- Timestamps styling: small muted text, similar to metadata row styling
- Timestamps are displayed identically on mobile and desktop
- Timestamps are loaded with activity data (no separate API call)

  3.2.3 Performance Requirements

- Accordion expands within 250ms with smooth animation (no API call required)
- Description data is included in PlanDto and loaded with initial plan fetch
- No loading state needed for accordion (data already in memory)
- Multiple accordions can be expanded simultaneously (independent state per activity)

### 3.3 Description Editing

3.3.1 Edit Capability

- Users can edit activity descriptions via EditActivityModal
- Description field is a textarea with 500 character limit
- Character counter displays remaining characters as user types
- Field supports three update modes:
  - Undefined: no change to existing description
  - Empty string: clears description (sets to null/empty)
  - 1-500 characters: updates description with validation
- EditActivityModal includes description field for both AI-generated and custom activities

  3.3.2 Edit Workflow

- User opens EditActivityModal via "Edit" option in ActivityCard dropdown menu
- Modal pre-fills description field with current description value
- User modifies description in textarea
- User clicks "Save"
- Optimistic UI update shows new description immediately in accordion (if expanded)
- API validates and persists change via PATCH /api/plans/{planId}/activities/{activityId}
- On success: cache invalidates, accordion content updates with new description
- On error: revert optimistic update, show error toast

  3.3.3 Validation Rules

- Minimum length: 1 character (if not empty)
- Maximum length: 500 characters
- Empty string is valid (clears description)
- Whitespace-only strings are treated as empty
- Validation occurs on both frontend (immediate feedback) and backend (enforcement)

### 3.4 Custom Activity Creation

3.4.1 Add Activity Button

- "+ Add Activity" button appears at the bottom of each day card
- Button is visible even when day has no activities
- Button opens CreateActivityModal when clicked
- Button has consistent styling across all days
- Button includes icon (plus sign) for visual clarity

  3.4.2 CreateActivityModal

- Modal is based on EditActivityModal with adjusted copy and behavior
- Modal header: "Add Custom Activity"
- Required field: title (1-200 characters)
- Optional fields:
  - Description (1-500 characters, textarea)
  - Duration (minutes, number input, default: 60)
  - Transport time (minutes, number input, default: empty)
  - Transport type ("public" | "car" | "walk")
- Form includes validation feedback for each field
- "Save" button is disabled until title requirement is met

  3.4.3 Creation Workflow

- User clicks "+ Add Activity" in desired day
- CreateActivityModal opens
- User enters activity title (required)
- User optionally fills description, duration, transport time, transport type
- User clicks "Save"
- API creates activity via POST /api/plans/{planId}/days/{dayId}/activities
- Activity is assigned next available order_index in the day
- Full plan refetch ensures UI consistency
- New activity appears in day
- Success toast confirms creation

  3.4.4 API Endpoint

- Endpoint: POST /api/plans/{planId}/days/{dayId}/activities
- Request body (CreateActivityDto):
  - title: string (required, 1-200 chars)
  - description: string | null (optional, 1-500 chars)
  - duration_minutes: number (optional, default: 60, range: 5-720)
  - transport_minutes: number | null (optional, default: null, range: 0-600)
- Response: 201 Created with ActivityDto
- Error responses:
  - 400: validation failure
  - 403: user doesn't own plan
  - 404: plan or day not found
  - 500: server error

### 3.5 Activity Deletion

3.5.1 Delete Action

- ActivityCard header includes a dropdown menu (â‹® three dots icon) on the right side
- Dropdown menu contains two options:
  - "Edit" - opens EditActivityModal
  - "Delete" - triggers deletion with confirmation
- Clicking "Delete" option triggers confirmation dialog
- Confirmation dialog message: "Are you sure you want to delete this activity? This action cannot be undone."
- Dialog includes "Cancel" and "Delete" buttons
- "Delete" button uses destructive styling (red)
- Dropdown does not trigger accordion expansion when clicked

  3.5.2 Deletion Workflow

- User clicks "Delete" in dropdown
- Confirmation dialog appears
- User clicks "Delete" to confirm
- Optimistic UI update removes activity immediately
- API deletes activity via DELETE /api/plans/{planId}/activities/{activityId}
- Backend recomputes order_index for remaining activities in day
- Full plan refetch ensures consistency
- On success: activity removed, success toast
- On error: revert optimistic update, error toast

  3.5.3 API Endpoint

- Endpoint: DELETE /api/plans/{planId}/activities/{activityId}
- Request: no body required
- Response: 204 No Content
- Backend behavior:
  - Delete activity record
  - Recompute order_index for remaining activities in same day (sequential: 1, 2, 3...)
  - Update day total_duration_minutes
  - Recalculate day warnings if applicable (>12 hours)
- Error responses:
  - 403: user doesn't own plan
  - 404: activity not found
  - 500: server error

    3.5.4 Empty Day Behavior

- When last activity in day is deleted, day card remains visible
- Empty day displays placeholder message: "No activities for this day. Click '+Add Activity' to create one."
- "+ Add Activity" button remains accessible in empty days
- Empty days maintain the day structure (Day 1, Day 2, etc.)
- Empty days do not generate warnings

### 3.6 Accordion Component Requirements

- Use shadcn/ui Accordion component (Radix UI based)
- Accordion type: "single" (only one activity expanded at a time is not enforced - multiple can be open)
- Collapsible: true (allows closing the currently open accordion)
- Animation: smooth height transition with 250ms duration
- Chevron icon rotates 180 degrees between collapsed/expanded states
- ARIA attributes required:
  - data-state="open" | "closed"
  - aria-expanded="true" | "false"
  - aria-controls links trigger to content
- Accordion trigger must NOT fire when:
  - Clicking on drag handle (GripVertical icon)
  - Clicking on dropdown menu (â‹® icon)
  - Dragging the activity card
- Entire card is draggable (including expanded accordion content)
- Accordion state is NOT persisted (always starts collapsed on page load)
- Users can identify source at a glance

### 3.7 Database Schema Updates

3.7.1 plan_activities Table Changes

- Add column: description (type: text, nullable: true)
- Existing columns (after block removal migration):
  - id, day_id, title, duration_minutes, transport_minutes, order_index, created_at, updated_at
- Note: block_id has been removed in previous migration (replaced with day_id)
- Note: created_at and updated_at timestamps are already present in the table
- Migration must handle existing plans gracefully (description defaults to null)
- Index considerations: no additional indexes required for this feature

  3.7.2 Schema Migration

- Migration adds columns without downtime (nullable allows incremental rollout)
- Existing plans continue to function with null descriptions
- New plans populate description during creation
- Rollback plan: drop columns if feature is reverted

### 3.8 API Schema Updates

3.8.1 DTOs

- ActivityDto: add description: string | null, include created_at: string, updated_at: string
- UpdateActivityDto: add description?: string | null (optional)
- CreateActivityDto: new DTO with title (required), description, duration_minutes, transport_minutes (optional)
- ActivityViewModel: add description: string | null, createdAt: string, updatedAt: string

  3.8.2 Zod Schemas

- activitySchema in ai.service.ts:
  - Add: description: z.string().max(500)
  - Update AI prompt with description generation instructions
- updateActivitySchema:
  - Add: description: z.string().min(1).max(500).optional().or(z.literal(""))
- createActivitySchema:
  - title: z.string().min(1).max(200)
  - description: z.string().min(1).max(500).optional().or(z.literal(""))
  - duration_minutes: z.number().int().min(5).max(720).optional()
  - transport_minutes: z.number().int().min(0).max(600).nullable().optional()

### 3.9 Plan Regeneration Behavior

3.9.1 Regeneration Scope

- Regeneration replaces entire plan including all activities and descriptions
- Preserved metadata:
  - Plan name, destination, dates
  - People count, trip type, comfort level, budget
  - Transport modes, note text
  - Plan ID, owner ID, timestamps
- Replaced data:
  - All days, blocks, activities
  - All activity titles, descriptions, durations, transport times
  - All custom activities are deleted

    3.9.2 User Communication

- RegeneratePlanModal includes warning message:
  - "Regenerating will replace your entire itinerary, including all activities and descriptions. Custom activities will be removed. Plan metadata (destination, dates, preferences) will be preserved. This action cannot be undone."
- Warning is prominently displayed before confirmation
- User must explicitly confirm understanding

  3.9.3 Technical Implementation

- Regeneration calls POST /api/plans/{planId}/regenerate
- Backend deletes all existing days/blocks/activities
- AI generates new plan with new descriptions
- Response includes complete new PlanDto
- Frontend refetches plan to ensure consistency

## 4. Feature Boundaries

### 4.1 In Scope

- AI-generated activity descriptions (up to 500 characters) during plan creation
- Accordion interface in ActivityCard for viewing descriptions and activity details on desktop and mobile
- Activity timestamps (created_at, updated_at) displayed in expanded accordion
- Description editing via UpdateActivityDto with validation
- Custom activity creation with title-only requirement
- Activity deletion with order_index recomputation
- Empty block placeholders with clear affordances
- Full plan refetch after activity deletion
- Database migration for description field
- API endpoints: POST /api/plans/{planId}/days/{dayId}/activities, DELETE /api/plans/{planId}/activities/{activityId}
- Updated Zod schemas and validation rules
- Regeneration warning about description replacement

### 4.2 Out of Scope

- Individual activity description regeneration (only full plan regeneration supported)
- Activity description versioning or history tracking
- Real-time description data (opening hours, ticket prices, current status)
- Description translations or multi-language support
- Activity images or media attachments
- Activity description templates or AI rewriting tools
- Bulk activity operations (delete multiple, move multiple)
- Activity duplication or copy functionality
- Activity export to external calendars
- Activity sharing with other users
- Activity comments or collaborative editing
- Advanced activity filtering or search within plan
- Activity categories or tags beyond time blocks
- Custom day structures or multi-day activities
- Activity dependencies or sequencing rules
- Budget tracking per activity
- Activity booking or reservation integration
- Social features (activity ratings, reviews, recommendations)
- Offline access to activity descriptions
- Activity description quality scoring or feedback
- AI explanation of why activity was suggested
- Activity alternatives or substitutions

### 4.3 Technical Constraints

- Maximum 500 characters per activity description (hard limit)
- Activity deletion requires full plan refetch (no partial updates)
- Custom activities limited to same fields as AI-generated activities
- No versioning: edits overwrite previous descriptions
- Description data loaded with plan (no lazy loading)
- Single API call per custom activity creation (no batch creation)
- Order_index recomputation is blocking operation during deletion
- Regeneration is all-or-nothing (no selective regeneration)
- Mobile and desktop must use identical modal interface
- Description must use plain text (no rich text formatting)

### 4.4 MVP Limitations

- No undo/redo for activity deletion or description edits
- No activity templates or quick-add presets
- No AI quality feedback mechanism for descriptions
- No description length recommendations based on activity duration
- No automated description enrichment after user edits
- No activity grouping or categorization within days
- No activity conflict detection or warnings
- No integration with external activity databases or APIs
- No description SEO optimization or metadata
- No analytics on description engagement or usefulness

### 4.5 Future Considerations (Post-MVP)

- Activity description templates for common activity types
- AI rewriting tool to shorten/expand/rephrase descriptions
- Activity images generated or fetched from external sources
- Integration with booking platforms (tickets, reservations)
- Activity recommendations based on user preferences and history
- Collaborative editing: share plans with travel companions
- Activity comments and personal notes separate from descriptions
- Export activities to Google Calendar, Apple Calendar, etc.
- Offline mode: cache descriptions for offline viewing
- Description quality feedback: thumbs up/down on AI descriptions
- Bulk operations: delete multiple activities, move between days
- Activity alternatives: "Show me similar activities"
- Budget tracking: add cost estimates per activity
- Advanced filters: search activities by keyword, duration, type
- Activity history: track changes and restore previous versions

## 5. User Stories

### US-001: View AI-Generated Activity Description

ID: US-001

Title: View AI-Generated Activity Description

Description: As a user viewing my travel plan, I want to expand activities to read detailed descriptions and see all activity details so that I can understand what each activity involves and decide if it fits my interests.

Acceptance Criteria:

- AC-001-1: Given I am viewing a plan details page with AI-generated activities, when I look at an ActivityCard, then I see a chevron icon indicating the card is expandable
- AC-001-2: Given an ActivityCard is collapsed, when I see the chevron, then it points downward indicating it can be expanded
- AC-001-3: Given I click on the ActivityCard header, when the accordion expands, then I see the full activity description (up to 500 characters)
- AC-001-4: Given the accordion is expanded, when I view the content, then I see timestamps at the top, followed by the description text, then a metadata row showing duration and transport information (e.g., "â±ï¸ 2h â€¢ ðŸš— 15 min")
- AC-001-4a: Given the accordion is expanded, when I view timestamps, then I see "Created: YYYY-MM-DD HH:mm" if the activity has not been edited
- AC-001-4b: Given the accordion is expanded for an edited activity, when I view timestamps, then I see "Created: YYYY-MM-DD HH:mm â€¢ Updated: YYYY-MM-DD HH:mm"
- AC-001-5: Given the accordion is expanded, when I click the card header again, then the accordion collapses with a smooth animation
- AC-001-6: Given the accordion is expanded, when the chevron is displayed, then it points upward indicating it can be collapsed
- AC-001-7: Given I am using a mobile device, when I expand an activity, then the accordion works identically to desktop (same layout and animation)
- AC-001-8: Given the accordion expands, when I measure the animation time, then it completes within 250ms
- AC-001-9: Given I am using keyboard navigation, when I tab to the ActivityCard and press Space or Enter, then the accordion toggles (expand/collapse)
- AC-001-10: Given I am using a screen reader, when I focus on the ActivityCard, then I hear "collapsed" or "expanded" announced based on current state

### US-002: View Empty Description Placeholder

ID: US-002

Title: View Empty Description Placeholder

Description: As a user viewing a custom activity without a description, I want to expand the activity and see a clear placeholder message so that I understand the activity has no description rather than experiencing a loading error.

Acceptance Criteria:

- AC-002-1: Given an activity has a null or empty description, when I look at the collapsed ActivityCard, then the chevron icon is still present (card is expandable)
- AC-002-2: Given an activity has no description, when I click the card header, then the accordion expands normally
- AC-002-3: Given an activity has no description, when the accordion expands, then I see timestamps at the top, followed by the message "No description added" in the description area
- AC-002-4: Given the accordion is expanded with no description, when I view the content, then I still see timestamps and the metadata row with duration and transport information if available
- AC-002-5: Given an activity with no description is expanded, when I click the card header, then it collapses normally like any other activity
- AC-002-6: Given multiple activities with and without descriptions, when I expand them, then all expand consistently regardless of description presence

### US-003: Edit Activity Description

ID: US-003

Title: Edit Activity Description

Description: As a user reviewing my itinerary, I want to edit or add notes to activity descriptions so that I can personalize the information or correct inaccuracies.

Acceptance Criteria:

- AC-003-1: Given I am viewing an activity, when I click "Edit" in the ActivityCard dropdown menu, then the EditActivityModal opens
- AC-003-2: Given the EditActivityModal is open, when I look at the form, then I see a description field (textarea) pre-filled with the current description
- AC-003-3: Given I am editing the description, when I type, then I see a character counter showing remaining characters out of 500
- AC-003-4: Given I modify the description, when I click "Save", then the description updates immediately (optimistic UI)
- AC-003-5: Given I submit an edited description, when the API call succeeds, then the cache invalidates and the accordion content updates to show the new description (if currently expanded)
- AC-003-6: Given I submit an edited description, when the API call fails, then the optimistic update reverts and I see an error toast
- AC-003-7: Given I clear the description field (empty string), when I save, then the description is cleared and the accordion shows "No description added" when expanded
- AC-003-8: Given I enter a description longer than 500 characters, when I try to save, then I see a validation error and the save is prevented
- AC-003-9: Given I enter a description with only whitespace, when I save, then it is treated as empty and the description is cleared
- AC-003-10: Given the description field is unchanged, when I save, then the API request includes undefined for description (no update)

### US-004: Edit Custom Activity Description

ID: US-004

Title: Edit Custom Activity Description

Description: As a user who created a custom activity without a description, I want to add a description later so that I can document important details about the activity.

Acceptance Criteria:

- AC-004-1: Given I am viewing a custom activity with no description, when I click "Edit", then the EditActivityModal opens with the description field empty
- AC-004-2: Given the EditActivityModal shows "Edit Custom Activity" in the header, when I look at the form, then I can clearly identify this is a custom activity
- AC-004-3: Given I add a new description to an empty field, when I save, then the description is created and appears in the accordion when expanded
- AC-004-4: Given I add a description, when I save and reopen the info modal, then I see my newly added description
- AC-004-5: Given I add a description that is too short (less than 1 character excluding whitespace), when I save, then I see a validation error

### US-005: Create Custom Activity with Full Details

ID: US-005

Title: Create Custom Activity with Full Details

Description: As a user planning my trip, I want to add my own activities with complete details (title, description, duration, transport time) so that I can include personal must-see places with full context.

Acceptance Criteria:

- AC-005-1: Given I am viewing a time block (morning, afternoon, or evening), when I scroll to the bottom, then I see a "+ Add Activity" button
- AC-005-2: Given I click "+ Add Activity", when the modal opens, then I see "Add Custom Activity" in the header
- AC-005-3: Given the CreateActivityModal is open, when I look at the form, then I see fields for: title (required), description (optional), duration (optional, default 60), transport time (optional, default empty)
- AC-005-4: Given I enter a title, description, duration, and transport time, when I click "Save", then a new custom activity is created in the selected day
- AC-005-5: Given the activity is created, when I view the plan, then the new activity appears at the bottom of the day with a custom activity badge
- AC-005-6: Given the activity is created, when I check the order_index, then it is set to the next available number in the day
- AC-005-7: Given the creation succeeds, when I view the UI, then I see a success toast confirming the activity was added
- AC-005-8: Given the creation fails, when the API returns an error, then I see an error toast with the failure reason
- AC-005-9: Given I enter all fields, when the activity is created, then I can immediately expand the accordion to see my description and all activity details
- AC-005-10: Given I create a custom activity, when I view it alongside AI-generated activities, then it appears visually identical to AI-generated activities

### US-006: Create Custom Activity with Title Only

ID: US-006

Title: Create Custom Activity with Title Only

Description: As a user quickly adding activities to my plan, I want to create a custom activity with just a title so that I can rapidly build out my itinerary without being forced to fill optional fields.

Acceptance Criteria:

- AC-006-1: Given the CreateActivityModal is open, when I enter only a title (no description, duration, or transport), then the "Save" button is enabled
- AC-006-2: Given I enter only a title, when I click "Save", then the activity is created successfully
- AC-006-3: Given the activity is created with only a title, when I view the ActivityCard, then it shows the title in collapsed state with chevron icon
- AC-006-4: Given the activity has no description, when I expand the accordion, then I see "No description added" in the description area and "â±ï¸ 60 min" in the metadata row
- AC-006-5: Given the activity is created, when I edit it later, then I can add description, duration, and transport time
- AC-006-6: Given I leave the title field empty, when I try to save, then the "Save" button is disabled and I see a validation message
- AC-006-7: Given I enter a title with only whitespace, when I try to save, then I see a validation error indicating the title is required

### US-007: Delete Activity from Plan

ID: US-007

Title: Delete Activity from Plan

Description: As a user refining my itinerary, I want to remove activities that don't interest me so that I can focus on what matters most for my trip.

Acceptance Criteria:

- AC-007-1: Given I am viewing an activity, when I click the dropdown menu (â‹® icon) in the ActivityCard header, then I see two options: "Edit" and "Delete"
- AC-007-2: Given I click "Delete", when the confirmation dialog appears, then I see the message "Are you sure you want to delete this activity? This action cannot be undone."
- AC-007-3: Given the confirmation dialog is open, when I click "Cancel", then the dialog closes and the activity is not deleted
- AC-007-4: Given the confirmation dialog is open, when I click "Delete", then the activity is removed immediately (optimistic update)
- AC-007-5: Given the activity is deleted, when the API call succeeds, then the full plan refetches and the activity is permanently removed
- AC-007-6: Given the activity is deleted, when the backend processes the request, then the order_index of remaining activities in the day is recomputed (1, 2, 3...)
- AC-007-7: Given the deletion succeeds, when I view the UI, then I see a success toast confirming the activity was deleted
- AC-007-8: Given the deletion fails, when the API returns an error, then the optimistic update reverts and I see an error toast
- AC-007-9: Given I delete an activity, when I check the day total_duration_minutes, then it is updated to reflect the removal
- AC-007-10: Given I delete an activity that had a warning, when the plan refetches, then day warnings are recalculated (>12 hours threshold)

### US-008: Delete Last Activity in Day

ID: US-008

Title: Delete Last Activity in Day

Description: As a user customizing my itinerary, I want to delete the last activity in a day and still see a clear way to add new activities so that I can rebuild the day as needed.

Acceptance Criteria:

- AC-008-1: Given a day has one activity, when I delete it, then the day card remains visible (not hidden)
- AC-008-2: Given a day is now empty, when I view it, then I see the placeholder message "No activities for this day. Click '+Add Activity' to create one."
- AC-008-3: Given a day is empty, when I view it, then I see the "+ Add Activity" button is still accessible
- AC-008-4: Given a day is empty, when I click "+ Add Activity", then the CreateActivityModal opens normally
- AC-008-5: Given a day is empty, when I create a new activity, then it is added with order_index = 1
- AC-008-6: Given a day is empty, when I check for warnings, then no warnings are generated for the empty day
- AC-008-7: Given multiple days exist, when one day is empty, then other days continue to display their activities normally

### US-009: View Plan with AI-Generated Descriptions

ID: US-009

Title: View Plan with AI-Generated Descriptions

Description: As a user who just generated a new travel plan, I want to see that all activities have descriptions so that I have complete information to evaluate my itinerary.

Acceptance Criteria:

- AC-010-1: Given I create a new plan, when the AI generates activities, then every activity includes a description
- AC-010-2: Given I view a newly generated plan, when I expand any activity accordion, then I see a description displayed
- AC-010-3: Given I expand any activity on a new plan, when the accordion opens, then I see a substantive description (not just the title repeated)
- AC-010-4: Given I view activity descriptions, when I check their length, then at least 95% are within the 1-500 character range
- AC-010-5: Given I view activity descriptions, when I read them, then they explain what visitors will experience, see, or do (not just factual metadata)
- AC-010-6: Given the AI generates descriptions, when I check the database, then all description fields are populated (not null)
- AC-010-7: Given the AI generates descriptions, when I review the content, then descriptions are written in Polish
- AC-010-8: Given the AI generates descriptions, when I compare title and description, then the description adds value beyond what's obvious from the title

### US-010: Regenerate Plan with Description Awareness

ID: US-010

Title: Regenerate Plan with Description Awareness

Description: As a user considering regenerating my plan, I want to be clearly warned that all descriptions and custom activities will be replaced so that I can make an informed decision.

Acceptance Criteria:

- AC-010-1: Given I click "Regenerate Plan", when the RegeneratePlanModal opens, then I see a warning message about description replacement
- AC-010-2: Given I am viewing the regeneration warning, when I read it, then it explicitly states "Regenerating will replace your entire itinerary, including all activities and descriptions. Custom activities will be removed."
- AC-010-3: Given I am viewing the regeneration warning, when I read it, then it states that plan metadata (destination, dates, preferences) will be preserved
- AC-010-4: Given I am viewing the regeneration warning, when I read it, then it states "This action cannot be undone"
- AC-010-5: Given I confirm regeneration, when the new plan is generated, then all previous activities and descriptions are deleted
- AC-010-6: Given I confirm regeneration, when the new plan is generated, then all new activities have fresh AI-generated descriptions
- AC-010-7: Given I had custom activities, when I regenerate, then all custom activities are removed from the new plan
- AC-010-8: Given I had edited descriptions, when I regenerate, then all edited descriptions are replaced with new AI-generated ones
- AC-010-9: Given I confirm regeneration, when the process completes, then the plan metadata (dates, destination, preferences) remains unchanged
- AC-010-10: Given I cancel the regeneration, when I return to the plan, then all existing activities and descriptions remain intact

### US-011: Edit Activity Duration and Transport Time

ID: US-011

Title: Edit Activity Duration and Transport Time

Description: As a user fine-tuning my itinerary, I want to edit activity durations and transport times while also being able to update descriptions so that all activity details are accurate.

Acceptance Criteria:

- AC-011-1: Given I open the EditActivityModal, when I view the form, then I see fields for title, description, duration, and transport time all editable
- AC-011-2: Given I modify multiple fields, when I save, then all changes are applied together in a single API call
- AC-011-3: Given I update the description but not duration/transport, when I save, then only the description is updated (other fields remain unchanged)
- AC-011-4: Given I update duration/transport but not description, when I save, then the description remains unchanged (undefined in request)
- AC-011-5: Given I update all fields, when the save succeeds, then the ActivityCard reflects all changes immediately
- AC-011-6: Given I increase the duration significantly, when I save, then block warnings are recalculated on refetch
- AC-011-7: Given I change transport time to null/empty, when I save, then the transport time is removed and the ActivityCard hides the transport display

### US-012: Create Activity in Specific Day

ID: US-012

Title: Create Activity in Specific Day

Description: As a user building my itinerary, I want to add activities to specific days so that I can organize my trip chronologically.

Acceptance Criteria:

- AC-012-1: Given I am viewing Day 1, when I click "+ Add Activity", then the new activity is created in Day 1
- AC-012-2: Given I am viewing Day 2, when I click "+ Add Activity", then the new activity is created in Day 2
- AC-012-3: Given I am viewing any day, when I click "+ Add Activity", then the new activity is created in that specific day
- AC-012-4: Given I create an activity in a specific day, when I check the API call, then it is sent to POST /api/plans/{planId}/days/{dayId}/activities with the correct dayId
- AC-012-5: Given I create an activity, when I view it in the plan, then it appears in the correct day where I clicked "+ Add Activity"
- AC-012-6: Given a day already has activities, when I add a new one, then it appears at the bottom with the next order_index
- AC-012-7: Given I want to add activities to different days, when I use "+ Add Activity" buttons, then each activity goes to its respective day

### US-013: Mobile Activity Description Access

ID: US-013

Title: Mobile Activity Description Access

Description: As a mobile user viewing my travel plan, I want to access activity descriptions with the same ease as desktop users so that I have a consistent experience across devices.

Acceptance Criteria:

- AC-013-1: Given I am on a mobile device, when I view an ActivityCard, then I see the chevron icon displayed clearly
- AC-013-2: Given I am on a mobile device, when I tap the card header, then the accordion expands within 250ms
- AC-013-3: Given the accordion is expanded on mobile, when I view it, then the layout is responsive and readable (no horizontal scrolling)
- AC-013-4: Given the accordion is expanded on mobile, when I tap the card header again, then it collapses smoothly
- AC-013-5: Given I am on mobile, when I use the accordion, then it functions identically to desktop (same animation and layout)
- AC-013-6: Given I am on mobile, when I expand an activity, then timestamps display in the same format as desktop (YYYY-MM-DD HH:mm)
- AC-013-7: Given I am on mobile, when I open the CreateActivityModal, then all fields are accessible and usable with touch input
- AC-013-8: Given I am on mobile, when I type in the description textarea, then the keyboard does not obscure the field or character counter

### US-014: Keyboard Navigation for Activity Actions

ID: US-014

Title: Keyboard Navigation for Activity Actions

Description: As a user who relies on keyboard navigation, I want to access all activity actions (view description, edit, delete, add) using only the keyboard so that I can use the application without a mouse.

Acceptance Criteria:

- AC-014-1: Given I am using keyboard navigation, when I tab through the plan, then I can reach each ActivityCard header
- AC-014-2: Given the ActivityCard has focus, when I press Enter or Space, then the accordion toggles (expand/collapse)
- AC-014-3: Given the accordion is expanded, when I press Enter or Space on the card again, then it collapses
- AC-014-4: Given I am using keyboard navigation, when I tab through an ActivityCard, then I can reach the dropdown menu button
- AC-014-5: Given the dropdown menu is open, when I use arrow keys, then I can navigate to "Edit" and "Delete" options
- AC-014-6: Given I am focused on "Delete", when I press Enter, then the confirmation dialog opens
- AC-014-7: Given I am using keyboard navigation, when I tab through a day card, then I can reach the "+ Add Activity" button
- AC-014-8: Given "+ Add Activity" has focus, when I press Enter, then the CreateActivityModal opens
- AC-014-9: Given a modal is open, when I tab through it, then focus stays trapped within the modal
- AC-014-10: Given I am focused on a modal's close button, when I press Enter, then the modal closes

### US-015: Screen Reader Activity Information

ID: US-015

Title: Screen Reader Activity Information

Description: As a user who relies on a screen reader, I want to hear clear descriptions of activities so that I can understand my itinerary without visual cues.

Acceptance Criteria:

- AC-015-1: Given I am using a screen reader, when I navigate to an ActivityCard, then I hear the activity title announced
- AC-015-2: Given I am using a screen reader, when I reach an ActivityCard, then I hear "collapsed" or "expanded" state announced along with the activity title
- AC-015-3: Given I am using a screen reader, when I expand the accordion, then I hear "expanded" announced
- AC-015-4: Given I am using a screen reader, when the accordion content is expanded, then I hear the timestamps read
- AC-015-5: Given I am using a screen reader, when the accordion content is expanded, then I hear the description text read
- AC-015-6: Given I am using a screen reader, when I navigate to an empty description, then I hear "No description added" announced
- AC-015-7: Given I am using a screen reader, when I reach the "+ Add Activity" button, then I hear "Add activity to Day [X]" announced
- AC-015-8: Given I am using a screen reader, when I open EditActivityModal, then I hear "Edit Activity" announced
- AC-015-9: Given I am using a screen reader, when I navigate form fields, then I hear appropriate labels for title, description, duration, and transport fields
- AC-015-10: Given I am using a screen reader, when validation errors occur, then I hear the error messages announced

### US-016: Validate API Request Data

ID: US-016

Title: Validate API Request Data

Description: As a system, I want to validate all activity-related API requests so that invalid data is rejected before reaching the database.

Acceptance Criteria:

- AC-016-1: Given I send a CreateActivityDto with no title, when the API validates it, then I receive a 400 error with message "Title is required"
- AC-016-2: Given I send a CreateActivityDto with title longer than 200 characters, when the API validates it, then I receive a 400 error with message "Title must be 200 characters or less"
- AC-016-3: Given I send a CreateActivityDto with description longer than 500 characters, when the API validates it, then I receive a 400 error with message "Description must be 500 characters or less"
- AC-016-4: Given I send a CreateActivityDto with duration_minutes < 5, when the API validates it, then I receive a 400 error with message "Duration must be at least 5 minutes"
- AC-016-5: Given I send a CreateActivityDto with duration_minutes > 720, when the API validates it, then I receive a 400 error with message "Duration must be 720 minutes or less"
- AC-016-6: Given I send a CreateActivityDto with transport_minutes < 0, when the API validates it, then I receive a 400 error with message "Transport time cannot be negative"
- AC-016-7: Given I send a CreateActivityDto with transport_minutes > 600, when the API validates it, then I receive a 400 error with message "Transport time must be 600 minutes or less"
- AC-016-8: Given I send an UpdateActivityDto with invalid description, when the API validates it, then I receive a 400 error with appropriate message
- AC-016-9: Given I send a request to a non-existent planId, when the API processes it, then I receive a 404 error with message "Plan not found"
- AC-016-10: Given I send a request to a plan I don't own, when the API checks authorization, then I receive a 403 error with message "You don't have access to this plan"

### US-017: Maintain Data Consistency After Deletion

ID: US-017

Title: Maintain Data Consistency After Deletion

Description: As a system, I want to maintain data consistency after activity deletion so that order_index values are sequential and block calculations are accurate.

Acceptance Criteria:

- AC-017-1: Given a day has activities with order_index [1, 2, 3, 4], when I delete activity 2, then remaining activities have order_index [1, 2, 3]
- AC-017-2: Given I delete an activity, when the backend processes the deletion, then order_index is recomputed for all remaining activities in the same day only
- AC-017-3: Given I delete an activity, when the backend processes it, then the day's total_duration_minutes is recalculated
- AC-017-4: Given I delete an activity that caused a warning, when the backend recalculates, then the day warning (>12 hours) is updated or removed
- AC-017-5: Given I delete an activity, when I query the database, then no orphaned activity records exist
- AC-017-6: Given I delete an activity, when I refetch the plan, then all activities display in correct order (1, 2, 3...)
- AC-017-7: Given I delete an activity and immediately create a new one, when I check order_index, then the new activity gets the next available number
- AC-017-8: Given multiple users are viewing the same plan, when one deletes an activity, then the other users see updated data on their next interaction (no stale cache)

### US-018: Handle Concurrent Activity Operations

ID: US-018

Title: Handle Concurrent Activity Operations

Description: As a system, I want to handle concurrent activity operations gracefully so that data integrity is maintained when multiple actions occur simultaneously.

Acceptance Criteria:

- AC-018-1: Given I am creating an activity, when another user deletes an activity in the same day simultaneously, then the full plan refetch ensures I see the correct final state
- AC-018-2: Given I am editing an activity description, when the plan is regenerated simultaneously, then my edit fails gracefully with an error message "Plan has been regenerated, please refresh"
- AC-018-3: Given I am deleting an activity, when another user edits the same activity simultaneously, then one operation succeeds and the other receives a 404 error
- AC-018-4: Given I submit an edit, when the API processes it, then the updated_at timestamp is updated atomically
- AC-018-5: Given multiple operations target the same plan, when they execute, then database transactions ensure consistent order_index recomputation

### US-019: Migrate Existing Plans to New Schema

ID: US-019

Title: Migrate Existing Plans to New Schema

Description: As a system administrator, I want to migrate existing plans to include the new description field so that the application continues to function without data loss.

Acceptance Criteria:

- AC-019-1: Given the migration runs, when it completes, then all existing plan_activities records have a description column
- AC-019-2: Given the migration runs, when it completes, then all existing activities have description set to null
- AC-019-3: Given existing plans are viewed after migration, when I load a plan, then all activities can be expanded via accordion
- AC-019-4: Given existing plans are viewed after migration, when I expand an activity, then I see timestamps displayed at the top
- AC-019-5: Given existing plans are viewed after migration, when I expand an activity, then I see "No description added" in the accordion content
- AC-019-6: Given existing plans are viewed after migration, when I edit an activity, then I can add a description and it saves correctly
- AC-019-7: Given the migration runs, when I check database performance, then there is no significant degradation in query times
- AC-019-8: Given the migration can be rolled back, when rollback is executed, then the columns are dropped cleanly without affecting other data
